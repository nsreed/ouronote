<ng-container [gunChain]="vectorNode$ | async" #vectorChain="gunChain">
  <mat-accordion multi dense displayMode="flat" *ngIf="project && (canEdit$ | async)" fxLayout="column"
    fxFlex="0 0 175px">
    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>Tools</mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <div gdColumns="auto auto" id="ToolsContainer">
          <button mat-button (click)="onUndoClick()"
            [disabled]="paperDirective.scope?.actions?.length === 0 || paperDirective.scope?.tool?.name !== 'pen'">
            <mat-icon>undo</mat-icon>
          </button>
          <button mat-button (click)="onInsertImageClick()" matTooltip="insert image">
            <mat-icon>photo_library</mat-icon>
          </button>
          <ng-container *ngFor="let tool of paper.scope.tools">
            <ng-container *ngIf="tool.enabled$ | async">
              <button mat-button [checked]="tool === paper.scope.tool" [value]="tool" [appTool]="tool"
                (click)="tool.activate()" [matTooltip]="tool.name" [matTooltipShowDelay]="900" [ngClass]="{
                  active: tool === paper.scope.tool
                }" class="tool">
                <ng-container *ngIf="tool.matIconName; else MatIcon">
                  <mat-icon>{{tool.matIconName}}</mat-icon>
                </ng-container>
                <ng-template #MatIcon>
                  <mat-icon *ngIf="tool.matIcon; else FaIcon" [svgIcon]="tool.matIcon"></mat-icon>
                </ng-template>
                <ng-template #FaIcon>
                  <mat-icon class="{{ 'fa fa-' + tool.icon }}"></mat-icon>
                </ng-template>
              </button>
            </ng-container>
          </ng-container>
        </div>
        <mat-divider></mat-divider>

        <!-- <ng-container *ngIf="paper.scope.tool?.propertyNames?.includes('content')">
          <app-text-form [appObject]="paper.scope.tool" appObjectProperty="content"></app-text-form>
        </ng-container> -->

        <!-- <div [appObject]="paper.project.currentStyle">
          <app-style-form [style]="paper.project.currentStyle"></app-style-form>
        </div> -->
        <div *ngIf="true" [appObject]="paper.project.currentStyle">
          <app-color-form appObjectProperty="strokeColor" [color]="paper.project.currentStyle.strokeColor"
            *ngIf="paper.scope.tool?.propertyNames?.includes('style')" [style]="paper.scope.tool.style"
            label="Stroke Color">
          </app-color-form>
          <app-color-form appObjectProperty="fillColor" [color]="paper.project.currentStyle.fillColor"
            [style]="paper.scope.tool.style" *ngIf="paper.scope.tool?.propertyNames?.includes('style')"
            label="Fill Color">
          </app-color-form>
          <ng-container *ngIf="paper.scope.tool?.propertyNames?.includes('style')">
            <app-stroke-width-form [tool]="paper.scope.tool" [style]="paper.scope.tool.style"></app-stroke-width-form>
            <p>Stroke Width</p>
          </ng-container>
          <ng-container *ngIf="paper.scope.tool.name === 'text' && paper.scope.tool?.propertyNames?.includes('style')">
            <app-number-form label="Font Size" [appObject]="paper.scope.tool.style" appObjectProperty="fontSize">
            </app-number-form>
          </ng-container>
          <div *ngIf="paper.scope.tool?.propertyNames?.includes('simplify')">
            <app-boolean-form [appObject]="paper.scope.tool" appObjectProperty="simplify"></app-boolean-form>
          </div>
          <div *ngIf="paper.scope.tool?.propertyNames?.includes('smoothingStrength') && paper.scope.tool?.simplify">
            <app-slider-form [appObject]="paper.scope.tool" appObjectProperty="smoothingStrength"></app-slider-form>
          </div>
          <div *ngIf="paper.scope.tool?.propertyNames?.includes('scale')">
            <app-boolean-form [appObject]="paper.scope.tool" appObjectProperty="scale"></app-boolean-form>
          </div>
          <app-selection-intersect-mode-form [tool]="paper.scope.tool"
            *ngIf="paper.scope.tool?.propertyNames?.includes('greedySelect')"></app-selection-intersect-mode-form>
        </div>

      </ng-template>
    </mat-expansion-panel>

    <!-- <mat-expansion-panel>
      <mat-expansion-panel-header>Style</mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <app-style-form [style]="project?.currentStyle"></app-style-form>
      </ng-template>
      <mat-action-row>
        <a mat-icon-button>
          <mat-icon>more_horiz</mat-icon>
        </a>
      </mat-action-row>
    </mat-expansion-panel> -->

    <mat-expansion-panel *ngIf="project.selectedItems?.length > 0" expanded>
      <mat-expansion-panel-header>Selection</mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <ng-container *ngIf="project.selectedItems?.length === 1 && project.selectedItems[0].className === 'PointText'">
          <app-text-form [appObject]="project.selectedItems[0]" appObjectProperty="content"
            (propertyValueChange)="onContentValueChange(project.selectedItems[0], $event)"
            (blur$)="onContentBlur(project.selectedItems[0], $event)"></app-text-form>
        </ng-container>
        <button mat-button (click)="project.deselectAll()">Clear</button>
        <app-selected-items [selectedItems]="project.selectedItems"></app-selected-items>
      </ng-template>
    </mat-expansion-panel>

    <mat-expansion-panel *ngIf="false">
      <mat-expansion-panel-header>Layers</mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <mat-action-list dense>
          <mat-list-item *ngFor="let layer of project?.layers" (click)="layer.activate()"
            [ngClass]="{ active: layer === project.activeLayer }">
            {{ layer.toString() }}
            {{ layer === project.activeLayer ? "*" : "" }}
            {{ layer.children?.length }}
          </mat-list-item>
        </mat-action-list>
      </ng-template>
      <mat-action-row>
        <a mat-icon-button (click)="addLayer()">
          <mat-icon>add</mat-icon>
        </a>
      </mat-action-row>
    </mat-expansion-panel>
  </mat-accordion>

  <div (paste)="onPaste($event)" fxFlex="1 1 auto" fxLayout="column" fxLayoutAlign="stretch stretch"
    id="CanvasContainer" #Container>
    <mat-toolbar *ngIf="vectorNode" fxLayoutAlign="stretch center" fxLayout="row">
      <span>
        {{ (vector$ | async)?.title }} -
        <ng-container *ngFor="let owner of owner$ | async | keyvalue">
          @{{ owner.key | alias | async }}
        </ng-container>
      </span>
      <ng-container *ngIf="vectorNode && !((layersNode$ | async).userCertificate$ | async)">
        <button color="primary" class="request" mat-raised-button (click)="requestAccess()"
          *ngIf="!(myRequest$ | async); else PendingApproval" matTooltip="Request permission to edit this vector.">
          <mat-icon>announcement</mat-icon>
          Request Access
        </button>
        <ng-template #PendingApproval>
          <button mat-flat-button disabled>
            <mat-icon>announcement</mat-icon>
            Pending Approval
          </button>
        </ng-template>
      </ng-container>

      <button mat-icon-button (click)="onCopyrightClick()">
        <mat-icon>copyright</mat-icon>
      </button>

      <button mat-icon-button [mat-menu-trigger-for]="ShareMenu">
        <mat-icon>share</mat-icon>
      </button>
      <mat-menu #ShareMenu>
        <button mat-menu-item (click)="copyViewLink()" matTooltip="Copy view link to clipboard">
          Copy View Link
        </button>
        <button mat-menu-item (click)="copyEditLink()" matTooltip="Copy edit link to clipboard">
          Copy Edit Link
        </button>
      </mat-menu>

      <button mat-icon-button (click)="onPeopleClick()" *ngIf="isOwner$ | async" #EditRequestsTooltip="matTooltip"
        [matTooltip]="
          (requestCount$ | async)
            ? 'There are ' + (requestCount$ | async) + ' edit requests'
            : null
        ">
        <mat-icon [matBadge]="(requestCount$ | async) || null" matBadgeColor="warn">people</mat-icon>
      </button>

      <a mat-icon-button [matMenuTriggerFor]="menuMore" color="primary">
        <mat-icon>more_horiz</mat-icon>
      </a>
      <div fxFlex></div>
      <mat-menu #menuMore>
        <button mat-menu-item (click)="favorite()">
          <mat-icon>favorite</mat-icon>
          Favorite
        </button>
        <button mat-menu-item (click)="download()">
          <mat-icon>file_download</mat-icon>
          Download JSON
        </button>
        <button mat-menu-item (click)="downloadImage()">
          <mat-icon>file_download</mat-icon>
          Download PNG
        </button>
      </mat-menu>
    </mat-toolbar>

    <div id="WorkspaceContainer">
      <!-- <div class="floating">0 fps</div> -->
      <canvas id="Workspace" appPaperEdit #paper="appPaperEdit"></canvas>
    </div>
  </div>
</ng-container>
