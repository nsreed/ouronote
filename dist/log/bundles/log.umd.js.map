{"version":3,"file":"log.umd.js","sources":["../../../projects/log/src/lib/log.service.ts","../../../projects/log/src/lib/log.component.ts","../../../projects/log/src/lib/log.module.ts","../../../projects/log/src/public-api.ts","../../../projects/log/src/log.ts"],"sourcesContent":["import {\n  Inject,\n  Injectable,\n  Optional,\n  EventEmitter,\n  SkipSelf,\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { scan, shareReplay, take } from 'rxjs/operators';\nexport enum LogLevel {\n  VERBOSE,\n  INFO,\n  WARN,\n  ERROR,\n}\n\nexport interface LogMessage {\n  name: string;\n  timestamp: number;\n  level: LogLevel;\n  message: string;\n  args: any[];\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class LogService {\n  constructor(\n    @Optional()\n    @Inject('log-name')\n    public name: string = 'app',\n    @Optional()\n    @SkipSelf()\n    public parent?: LogService\n  ) {\n    this.name = this.name || 'app';\n    if (this.name !== 'root' && !parent) {\n      this.parent = LogService.root;\n    }\n  }\n\n  public static readonly root = new LogService('root');\n\n  static readonly buffer$ = LogService.root.out$.pipe(\n    scan((acc, val) => {\n      acc.push(val as never);\n      if (acc.length > 1000) {\n        acc.shift();\n      }\n      return acc;\n    }, []),\n    shareReplay(1)\n  );\n\n  protected _out$ = new EventEmitter<LogMessage>();\n  out$ = this._out$;\n  outSub = this.out$.subscribe((m) => {\n    if (this.parent) {\n      this.parent._out$.emit(m);\n    } else {\n      console.log(\n        '%s %s %s %s',\n        m.name,\n        new Date(m.timestamp).toISOString(),\n        m.message,\n        JSON.stringify(m.args)\n      );\n    }\n  });\n\n  level: LogLevel = LogLevel.INFO;\n\n  private supplementals = new Map<string, LogService>();\n\n  static getLogger(name: string) {\n    return new LogService(name);\n  }\n\n  verbose(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.VERBOSE, message, args);\n    this._out$.emit(packed);\n  }\n\n  log(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.INFO, message, args);\n    this._out$.emit(packed);\n  }\n\n  warn(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.WARN, message, args);\n    this._out$.emit(packed);\n  }\n\n  error(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.ERROR, message, args);\n    this._out$.emit(packed);\n  }\n\n  supplemental(name: string): LogService {\n    if (!this.supplementals.has(name)) {\n      const supplementalLog = new LogService(name, this);\n      // supplementalLog.out$.subscribe((msg) => {\n      //   console.log('supplemental message', msg);\n      //   this._out$.emit(msg);\n      // });\n      this.supplementals.set(name, supplementalLog);\n    }\n    return this.supplementals.get(name) as LogService;\n  }\n\n  private buildMessage(\n    level: LogLevel,\n    message: string,\n    args: any[]\n  ): LogMessage {\n    return {\n      level,\n      message,\n      args,\n      timestamp: Date.now(),\n      name: this.name,\n    };\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'lib-log',\n  template: `\n    <p>\n      log works!\n    </p>\n  `,\n  styles: [\n  ]\n})\nexport class LogComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","import { NgModule } from '@angular/core';\n\n@NgModule({\n  declarations: [],\n  imports: [],\n  exports: [],\n})\nexport class LogModule {}\n","/*\n * Public API Surface of log\n */\n\nexport * from './lib/log.service';\nexport * from './lib/log.component';\nexport * from './lib/log.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["LogLevel","EventEmitter","scan","shareReplay","Injectable","Optional","Inject","SkipSelf","i0","Component","NgModule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AASYA;IAAZ,WAAY,QAAQ;QAClB,6CAAO,CAAA;QACP,uCAAI,CAAA;QACJ,uCAAI,CAAA;QACJ,yCAAK,CAAA;IACP,CAAC,EALWA,gBAAQ,KAARA,gBAAQ,QAKnB;;QAcC,oBAGS,IAAoB,EAGpB,MAAmB;YAN5B,iBAYC;YATQ,qBAAA,EAAA,YAAoB;YAApB,SAAI,GAAJ,IAAI,CAAgB;YAGpB,WAAM,GAAN,MAAM,CAAa;YAqBlB,UAAK,GAAG,IAAIC,eAAY,EAAc,CAAC;YACjD,SAAI,GAAG,IAAI,CAAC,KAAK,CAAC;YAClB,WAAM,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,UAAC,CAAC;gBAC7B,IAAI,KAAI,CAAC,MAAM,EAAE;oBACf,KAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;iBAC3B;qBAAM;oBACL,OAAO,CAAC,GAAG,CACT,aAAa,EACb,CAAC,CAAC,IAAI,EACN,IAAI,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,WAAW,EAAE,EACnC,CAAC,CAAC,OAAO,EACT,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CACvB,CAAC;iBACH;aACF,CAAC,CAAC;YAEH,UAAK,GAAaD,gBAAQ,CAAC,IAAI,CAAC;YAExB,kBAAa,GAAG,IAAI,GAAG,EAAsB,CAAC;YArCpD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,IAAI,KAAK,CAAC;YAC/B,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,IAAI,CAAC,MAAM,EAAE;gBACnC,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC,IAAI,CAAC;aAC/B;SACF;QAmCM,oBAAS,GAAhB,UAAiB,IAAY;YAC3B,OAAO,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;SAC7B;QAED,4BAAO,GAAP,UAAQ,OAAe;YAAE,cAAc;iBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;gBAAd,6BAAc;;YACrC,IAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAACA,gBAAQ,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;YAClE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACzB;QAED,wBAAG,GAAH,UAAI,OAAe;YAAE,cAAc;iBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;gBAAd,6BAAc;;YACjC,IAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAACA,gBAAQ,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;YAC/D,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACzB;QAED,yBAAI,GAAJ,UAAK,OAAe;YAAE,cAAc;iBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;gBAAd,6BAAc;;YAClC,IAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAACA,gBAAQ,CAAC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;YAC/D,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACzB;QAED,0BAAK,GAAL,UAAM,OAAe;YAAE,cAAc;iBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;gBAAd,6BAAc;;YACnC,IAAM,MAAM,GAAG,IAAI,CAAC,YAAY,CAACA,gBAAQ,CAAC,KAAK,EAAE,OAAO,EAAE,IAAI,CAAC,CAAC;YAChE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SACzB;QAED,iCAAY,GAAZ,UAAa,IAAY;YACvB,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;gBACjC,IAAM,eAAe,GAAG,IAAI,UAAU,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;;;;;gBAKnD,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;aAC/C;YACD,OAAO,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAe,CAAC;SACnD;QAEO,iCAAY,GAAZ,UACN,KAAe,EACf,OAAe,EACf,IAAW;YAEX,OAAO;gBACL,KAAK,OAAA;gBACL,OAAO,SAAA;gBACP,IAAI,MAAA;gBACJ,SAAS,EAAE,IAAI,CAAC,GAAG,EAAE;gBACrB,IAAI,EAAE,IAAI,CAAC,IAAI;aAChB,CAAC;SACH;;;IAjFsB,eAAI,GAAG,IAAI,UAAU,CAAC,MAAM,CAAC,CAAC;IAErC,kBAAO,GAAG,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CACjDE,cAAI,CAAC,UAAC,GAAG,EAAE,GAAG;QACZ,GAAG,CAAC,IAAI,CAAC,GAAY,CAAC,CAAC;QACvB,IAAI,GAAG,CAAC,MAAM,GAAG,IAAI,EAAE;YACrB,GAAG,CAAC,KAAK,EAAE,CAAC;SACb;QACD,OAAO,GAAG,CAAC;IACb,CAAC,EAAE,EAAE,CAAC,EACNC,qBAAW,CAAC,CAAC,CAAC,CACf,CAAC;wEA1BS,UAAU,yBAGX,UAAU,6BAIF,UAAU;iEAPjB,UAAU,WAAV,UAAU,mBAFT,MAAM;;2FAEP,UAAU;sBAHtBC,aAAU;uBAAC;wBACV,UAAU,EAAE,MAAM;qBACnB;;;kCAGIC,WAAQ;;kCACRC,SAAM;mCAAC,UAAU;sCAIF,UAAU;kCAFzBD,WAAQ;;kCACRE,WAAQ;;;;;;QCnBX;SAAiB;QAEjB,+BAAQ,GAAR;SACC;;;4EALU,YAAY;gEAAZ,YAAY;;gBAPrBC,oCAAG;gBACDA,uCACF;gBAAAA,4BAAI;;;;2FAKK,YAAY;sBAVxBC,YAAS;uBAAC;wBACT,QAAQ,EAAE,SAAS;wBACnB,QAAQ,EAAE,2CAIT;wBACD,MAAM,EAAE,EACP;qBACF;;;;;QCJD;;;;4DAAa,SAAS;gHAAT,SAAS,kBAHX,EAAE;;2FAGA,SAAS;sBALrBC,WAAQ;uBAAC;wBACR,YAAY,EAAE,EAAE;wBAChB,OAAO,EAAE,EAAE;wBACX,OAAO,EAAE,EAAE;qBACZ;;;;ICND;;;;ICAA;;;;;;;;;;;;;;"}