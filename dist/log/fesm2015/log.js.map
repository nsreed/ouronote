{"version":3,"file":"log.js","sources":["../../../projects/log/src/lib/log.service.ts","../../../projects/log/src/lib/log.component.ts","../../../projects/log/src/lib/log.module.ts","../../../projects/log/src/public-api.ts","../../../projects/log/src/log.ts"],"sourcesContent":["import {\n  Inject,\n  Injectable,\n  Optional,\n  EventEmitter,\n  SkipSelf,\n} from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { scan, shareReplay, take } from 'rxjs/operators';\nexport enum LogLevel {\n  VERBOSE,\n  INFO,\n  WARN,\n  ERROR,\n}\n\nexport interface LogMessage {\n  name: string;\n  timestamp: number;\n  level: LogLevel;\n  message: string;\n  args: any[];\n}\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class LogService {\n  constructor(\n    @Optional()\n    @Inject('log-name')\n    public name: string = 'app',\n    @Optional()\n    @SkipSelf()\n    public parent?: LogService\n  ) {\n    this.name = this.name || 'app';\n    if (this.name !== 'root' && !parent) {\n      this.parent = LogService.root;\n    }\n  }\n\n  public static readonly root = new LogService('root');\n\n  static readonly buffer$ = LogService.root.out$.pipe(\n    scan((acc, val) => {\n      acc.push(val as never);\n      if (acc.length > 1000) {\n        acc.shift();\n      }\n      return acc;\n    }, []),\n    shareReplay(1)\n  );\n\n  protected _out$ = new EventEmitter<LogMessage>();\n  out$ = this._out$;\n  outSub = this.out$.subscribe((m) => {\n    if (this.parent) {\n      this.parent._out$.emit(m);\n    } else {\n      console.log(\n        `%s %s ${m.message}`,\n        m.name,\n        new Date(m.timestamp).toISOString(),\n        ...m.args\n      );\n    }\n  });\n\n  level: LogLevel = LogLevel.INFO;\n\n  private supplementals = new Map<string, LogService>();\n\n  static getLogger(name: string) {\n    return new LogService(name, LogService.root);\n  }\n\n  verbose(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.VERBOSE, message, args);\n    this._out$.emit(packed);\n  }\n\n  log(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.INFO, message, args);\n    this._out$.emit(packed);\n  }\n\n  warn(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.WARN, message, args);\n    this._out$.emit(packed);\n  }\n\n  error(message: string, ...args: any[]) {\n    const packed = this.buildMessage(LogLevel.ERROR, message, args);\n    this._out$.emit(packed);\n  }\n\n  supplemental(name: string): LogService {\n    if (!this.supplementals.has(name)) {\n      const supplementalLog = new LogService(name, this);\n      // supplementalLog.out$.subscribe((msg) => {\n      //   console.log('supplemental message', msg);\n      //   this._out$.emit(msg);\n      // });\n      this.supplementals.set(name, supplementalLog);\n    }\n    return this.supplementals.get(name) as LogService;\n  }\n\n  private buildMessage(\n    level: LogLevel,\n    message: string,\n    args: any[]\n  ): LogMessage {\n    return {\n      level,\n      message,\n      args,\n      timestamp: Date.now(),\n      name: this.name,\n    };\n  }\n}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'lib-log',\n  template: `\n    <p>\n      log works!\n    </p>\n  `,\n  styles: [\n  ]\n})\nexport class LogComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","import { NgModule } from '@angular/core';\n\n@NgModule({\n  declarations: [],\n  imports: [],\n  exports: [],\n})\nexport class LogModule {}\n","/*\n * Public API Surface of log\n */\n\nexport * from './lib/log.service';\nexport * from './lib/log.component';\nexport * from './lib/log.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}